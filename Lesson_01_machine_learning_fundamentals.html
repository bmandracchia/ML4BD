
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The Machine Learning Fundamentals &#8212; Introduction to Machine Learning for Biomedical Data</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Lesson_01_machine_learning_fundamentals';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Introduction to Machine Learning for Biomedical Data - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Introduction to Machine Learning for Biomedical Data - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks.html">Content with notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="00_python_primer.html">Python: A Primer</a></li>






</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/bmandracchia/ML4BD" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/bmandracchia/ML4BD/issues/new?title=Issue%20on%20page%20%2FLesson_01_machine_learning_fundamentals.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Lesson_01_machine_learning_fundamentals.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The Machine Learning Fundamentals</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">The Machine Learning Fundamentals</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-machine-learning-pipeline">The Machine Learning Pipeline</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-classification-and-clustering">Regression, Classification, and Clustering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-main-steps-of-the-machine-learning-pipeline">The main steps of the machine learning pipeline</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-example-does-money-make-people-happier">Code example: Does money make people happier?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-and-prepare-life-satisfaction-data">Load and prepare Life satisfaction data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection-a-simple-linear-model">Model selection: a simple linear model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-normal-equation">The Normal Equation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-minimization">Least Squares Minimization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-challenges-in-machine-learning">Main Challenges in Machine Learning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quantity-of-training-data">Quantity of Training Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#poor-quality-data">Poor-quality data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#irrelevant-features">Irrelevant Features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overfitting-the-training-data">Overfitting the Training Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#model-regularization">Model Regularization</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#underfitting-the-training-data">Underfitting the Training Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="the-machine-learning-fundamentals">
<h1>The Machine Learning Fundamentals<a class="headerlink" href="#the-machine-learning-fundamentals" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<p><strong>Machine learning</strong> fits mathematical models to data in order to derive insights or make predictions.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[Machine Learning is the] field of study that gives computers the ability to learn
without being explicitly programmed.
    —Arthur Samuel, 1959
</pre></div>
</div>
<p>These models take <strong>features</strong> as input. A feature is a numeric representation of an aspect of raw data.
Features sit between data and models in the machine learning pipeline.</p>
<p><strong>Feature engineering</strong> is the act of extracting features from raw data and transforming them into formats that are suitable for the machine learning model. It is a crucial step in the machine learning pipeline, because the right features can ease the difficulty of modeling, and therefore enable the pipeline to output results of higher quality.</p>
<p>Machine Learning is great for:</p>
<ul class="simple">
<li><p>Problems for which existing solutions require a lot of hand-tuning or long lists of rules: one Machine Learning algorithm can often simplify code and perform better.</p></li>
<li><p>Complex problems for which there is no good solution at all using a traditional approach: the best Machine Learning techniques can find a solution.</p></li>
<li><p>Fluctuating environments: a Machine Learning system can adapt to new data.</p></li>
<li><p>Getting insights about complex problems and large amounts of data.</p></li>
</ul>
<section id="the-machine-learning-pipeline">
<h2>The Machine Learning Pipeline<a class="headerlink" href="#the-machine-learning-pipeline" title="Link to this heading">#</a></h2>
<p><strong>Data</strong>: What we call data are observations of real-world phenomena. Each piece of data provides a small window into a limited aspect of reality. The collection of all of these observations gives us a picture of the whole. But the picture is messy because it is composed of a thousand little pieces, and there’s always measurement noise and missing pieces.</p>
<p><img alt="image.png" src="attachment:image.png" /></p>
<p><img alt="image.png" src="attachment:image.png" /></p>
<p><strong>Models</strong>: A mathematical model of data describes the relationships between different aspects of the data. For instance, a model that recommends music might measure the similarity between users (based on their listening habits), and recommend the same artists to users who have listened to a lot of the same songs.</p>
<p><strong>Features</strong>: A feature is a numeric representation of raw data. There are many ways to turn raw data into numeric measurements, which is why features can end up looking like a lot of things. Naturally, features must derive from the type of data that is available.</p>
<p>Perhaps less obvious is the fact that they are also tied to the model; some models are more appropriate for some types of features, and vice versa. The right features are relevant to the task at hand and should be easy for the model to ingest. <strong>Feature engineering</strong> is the process of formulating the most appropriate features given the data, the model, and the task.</p>
<p><img alt="image.png" src="attachment:image.png" /></p>
<p><img alt="image.png" src="attachment:image.png" /></p>
<section id="regression-classification-and-clustering">
<h3>Regression, Classification, and Clustering<a class="headerlink" href="#regression-classification-and-clustering" title="Link to this heading">#</a></h3>
<p><img alt="image.png" src="attachment:image.png" /></p>
</section>
<section id="the-main-steps-of-the-machine-learning-pipeline">
<h3>The main steps of the machine learning pipeline<a class="headerlink" href="#the-main-steps-of-the-machine-learning-pipeline" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Look at the big picture.</p></li>
<li><p>Get the data.</p></li>
<li><p>Discover and visualize the data to gain insights.</p></li>
<li><p>Prepare the data for Machine Learning algorithms.</p></li>
<li><p>Select a model and train it.</p></li>
<li><p>Fine-tune your model.</p></li>
<li><p>Present your solution.</p></li>
<li><p>Launch, monitor, and maintain your system.</p></li>
</ol>
<p><img alt="Alt text" src="image-8.png" /></p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h1>
<p>This project requires Python 3.7 or above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Scikit-Learn ≥1.0.1 is required:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>
<span class="kn">import</span> <span class="nn">sklearn</span>

<span class="k">assert</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.0.1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">sklearn</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">assert</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.0.1&quot;</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;sklearn&#39;
</pre></div>
</div>
</div>
</div>
<p>Let’s define the default font sizes, to plot pretty figures:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Make this notebook’s output stable across runs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="code-example-does-money-make-people-happier">
<h2>Code example: Does money make people happier?<a class="headerlink" href="#code-example-does-money-make-people-happier" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="c1"># Download and prepare the data</span>
<span class="n">data_root</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/ageron/data/raw/main/&quot;</span>
<span class="n">lifesat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_root</span> <span class="o">+</span> <span class="s2">&quot;lifesat/lifesat.csv&quot;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">lifesat</span><span class="p">[[</span><span class="s2">&quot;GDP per capita (USD)&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">lifesat</span><span class="p">[[</span><span class="s2">&quot;Life satisfaction&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Visualize the data</span>
<span class="n">lifesat</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="s2">&quot;GDP per capita (USD)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Life satisfaction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">23_500</span><span class="p">,</span> <span class="mi">62_500</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/115dad878bd8fe4a9dcdf1d5e1040932a8cf1079efa3443f084b2e4ffcfe1bee.png" src="_images/115dad878bd8fe4a9dcdf1d5e1040932a8cf1079efa3443f084b2e4ffcfe1bee.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a linear model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

<span class="c1"># Train the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Make a prediction for Cyprus</span>
<span class="n">X_new</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">37_655.2</span><span class="p">]]</span>  <span class="c1"># Cyprus&#39; GDP per capita in 2020</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_new</span><span class="p">))</span> <span class="c1"># outputs [[6.30165767]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[6.30165767]]
</pre></div>
</div>
</div>
</div>
<p>Replacing the Linear Regression model with k-Nearest Neighbors (in this example, k = 3) regression in the previous code is as simple as replacing these two
lines:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
</pre></div>
</div>
<p>with these two:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a 3-Nearest Neighbors regression model</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Train the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Make a prediction for Cyprus</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_new</span><span class="p">))</span> <span class="c1"># outputs [[6.33333333]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[6.33333333]]
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-and-prepare-life-satisfaction-data">
<h2>Load and prepare Life satisfaction data<a class="headerlink" href="#load-and-prepare-life-satisfaction-data" title="Link to this heading">#</a></h2>
<p>Create a function to save the figures:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Where to save the figures</span>
<span class="n">IMAGES_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;images&quot;</span> <span class="o">/</span> <span class="s2">&quot;fundamentals&quot;</span>
<span class="n">IMAGES_PATH</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="n">fig_id</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig_extension</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">IMAGES_PATH</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">fig_extension</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fig_extension</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To create <code class="docutils literal notranslate"><span class="pre">lifesat.csv</span></code>, we use the Better Life Index (BLI) data from <a class="reference external" href="http://stats.oecd.org/index.aspx?DataSetCode=BLI">OECD’s website</a> (to get the Life Satisfaction for each country), and World Bank GDP per capita data from <a class="reference external" href="https://ourworldindata.org/grapher/gdp-per-capita-worldbank">OurWorldInData.org</a>. The BLI data is in <code class="docutils literal notranslate"><span class="pre">datasets/lifesat/oecd_bli.csv</span></code> (data from 2020), and the GDP per capita data is in <code class="docutils literal notranslate"><span class="pre">datasets/lifesat/gdp_per_capita.csv</span></code> (data up to 2020).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">datapath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;datasets&quot;</span> <span class="o">/</span> <span class="s2">&quot;lifesat&quot;</span>
<span class="n">datapath</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">data_root</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/ageron/data/raw/main/&quot;</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;oecd_bli.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;gdp_per_capita.csv&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">data_root</span> <span class="o">+</span> <span class="s2">&quot;lifesat/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">datapath</span> <span class="o">/</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading oecd_bli.csv
Downloading gdp_per_capita.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oecd_bli</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;oecd_bli.csv&quot;</span><span class="p">)</span>
<span class="n">gdp_per_capita</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;gdp_per_capita.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Preprocess the GDP per capita data to keep only the year 2020:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdp_year</span> <span class="o">=</span> <span class="mi">2020</span>
<span class="n">gdppc_col</span> <span class="o">=</span> <span class="s2">&quot;GDP per capita (USD)&quot;</span>
<span class="n">lifesat_col</span> <span class="o">=</span> <span class="s2">&quot;Life satisfaction&quot;</span>

<span class="n">gdp_per_capita</span> <span class="o">=</span> <span class="n">gdp_per_capita</span><span class="p">[</span><span class="n">gdp_per_capita</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">gdp_year</span><span class="p">]</span>
<span class="n">gdp_per_capita</span> <span class="o">=</span> <span class="n">gdp_per_capita</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="s2">&quot;Year&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gdp_per_capita</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="n">gdppc_col</span><span class="p">]</span>
<span class="n">gdp_per_capita</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">gdp_per_capita</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GDP per capita (USD)</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Afghanistan</th>
      <td>1978.961579</td>
    </tr>
    <tr>
      <th>Africa Eastern and Southern</th>
      <td>3387.594670</td>
    </tr>
    <tr>
      <th>Africa Western and Central</th>
      <td>4003.158913</td>
    </tr>
    <tr>
      <th>Albania</th>
      <td>13295.410885</td>
    </tr>
    <tr>
      <th>Algeria</th>
      <td>10681.679297</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Preprocess the OECD BLI data to keep only the <code class="docutils literal notranslate"><span class="pre">Life</span> <span class="pre">satisfaction</span></code> column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oecd_bli</span> <span class="o">=</span> <span class="n">oecd_bli</span><span class="p">[</span><span class="n">oecd_bli</span><span class="p">[</span><span class="s2">&quot;INEQUALITY&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;TOT&quot;</span><span class="p">]</span>
<span class="n">oecd_bli</span> <span class="o">=</span> <span class="n">oecd_bli</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Indicator&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>

<span class="n">oecd_bli</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Indicator</th>
      <th>Air pollution</th>
      <th>Dwellings without basic facilities</th>
      <th>Educational attainment</th>
      <th>Employees working very long hours</th>
      <th>Employment rate</th>
      <th>Feeling safe walking alone at night</th>
      <th>Homicide rate</th>
      <th>Household net adjusted disposable income</th>
      <th>Household net wealth</th>
      <th>Housing expenditure</th>
      <th>...</th>
      <th>Personal earnings</th>
      <th>Quality of support network</th>
      <th>Rooms per person</th>
      <th>Self-reported health</th>
      <th>Stakeholder engagement for developing regulations</th>
      <th>Student skills</th>
      <th>Time devoted to leisure and personal care</th>
      <th>Voter turnout</th>
      <th>Water quality</th>
      <th>Years in education</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Australia</th>
      <td>5.0</td>
      <td>NaN</td>
      <td>81.0</td>
      <td>13.04</td>
      <td>73.0</td>
      <td>63.5</td>
      <td>1.1</td>
      <td>32759.0</td>
      <td>427064.0</td>
      <td>20.0</td>
      <td>...</td>
      <td>49126.0</td>
      <td>95.0</td>
      <td>NaN</td>
      <td>85.0</td>
      <td>2.7</td>
      <td>502.0</td>
      <td>14.35</td>
      <td>91.0</td>
      <td>93.0</td>
      <td>21.0</td>
    </tr>
    <tr>
      <th>Austria</th>
      <td>16.0</td>
      <td>0.9</td>
      <td>85.0</td>
      <td>6.66</td>
      <td>72.0</td>
      <td>80.6</td>
      <td>0.5</td>
      <td>33541.0</td>
      <td>308325.0</td>
      <td>21.0</td>
      <td>...</td>
      <td>50349.0</td>
      <td>92.0</td>
      <td>1.6</td>
      <td>70.0</td>
      <td>1.3</td>
      <td>492.0</td>
      <td>14.55</td>
      <td>80.0</td>
      <td>92.0</td>
      <td>17.0</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>15.0</td>
      <td>1.9</td>
      <td>77.0</td>
      <td>4.75</td>
      <td>63.0</td>
      <td>70.1</td>
      <td>1.0</td>
      <td>30364.0</td>
      <td>386006.0</td>
      <td>21.0</td>
      <td>...</td>
      <td>49675.0</td>
      <td>91.0</td>
      <td>2.2</td>
      <td>74.0</td>
      <td>2.0</td>
      <td>503.0</td>
      <td>15.70</td>
      <td>89.0</td>
      <td>84.0</td>
      <td>19.3</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>10.0</td>
      <td>6.7</td>
      <td>49.0</td>
      <td>7.13</td>
      <td>61.0</td>
      <td>35.6</td>
      <td>26.7</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>90.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.2</td>
      <td>395.0</td>
      <td>NaN</td>
      <td>79.0</td>
      <td>73.0</td>
      <td>16.2</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>7.0</td>
      <td>0.2</td>
      <td>91.0</td>
      <td>3.69</td>
      <td>73.0</td>
      <td>82.2</td>
      <td>1.3</td>
      <td>30854.0</td>
      <td>423849.0</td>
      <td>22.0</td>
      <td>...</td>
      <td>47622.0</td>
      <td>93.0</td>
      <td>2.6</td>
      <td>88.0</td>
      <td>2.9</td>
      <td>523.0</td>
      <td>14.56</td>
      <td>68.0</td>
      <td>91.0</td>
      <td>17.3</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 24 columns</p>
</div></div></div>
</div>
<p>Now let’s merge the life satisfaction data and the GDP per capita data, keeping only the GDP per capita and Life satisfaction columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_country_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">oecd_bli</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">gdp_per_capita</span><span class="p">,</span>
                              <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">full_country_stats</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">full_country_stats</span> <span class="o">=</span> <span class="n">full_country_stats</span><span class="p">[[</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">lifesat_col</span><span class="p">]]</span>

<span class="n">full_country_stats</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GDP per capita (USD)</th>
      <th>Life satisfaction</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>South Africa</th>
      <td>11466.189672</td>
      <td>4.7</td>
    </tr>
    <tr>
      <th>Colombia</th>
      <td>13441.492952</td>
      <td>6.3</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>14063.982505</td>
      <td>6.4</td>
    </tr>
    <tr>
      <th>Mexico</th>
      <td>17887.750736</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>23324.524751</td>
      <td>6.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To illustrate the risk of overfitting, we use only part of the data in most figures (all countries with a GDP per capita between <code class="docutils literal notranslate"><span class="pre">min_gdp</span></code> and <code class="docutils literal notranslate"><span class="pre">max_gdp</span></code>). Later we reveal the missing countries, and show that they don’t follow the same linear trend at all.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_gdp</span> <span class="o">=</span> <span class="mi">23_500</span>
<span class="n">max_gdp</span> <span class="o">=</span> <span class="mi">62_500</span>

<span class="n">country_stats</span> <span class="o">=</span> <span class="n">full_country_stats</span><span class="p">[(</span><span class="n">full_country_stats</span><span class="p">[</span><span class="n">gdppc_col</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_gdp</span><span class="p">)</span> <span class="o">&amp;</span>
                                   <span class="p">(</span><span class="n">full_country_stats</span><span class="p">[</span><span class="n">gdppc_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_gdp</span><span class="p">)]</span>
<span class="n">country_stats</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GDP per capita (USD)</th>
      <th>Life satisfaction</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Russia</th>
      <td>26456.387938</td>
      <td>5.8</td>
    </tr>
    <tr>
      <th>Greece</th>
      <td>27287.083401</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>Turkey</th>
      <td>28384.987785</td>
      <td>5.5</td>
    </tr>
    <tr>
      <th>Latvia</th>
      <td>29932.493910</td>
      <td>5.9</td>
    </tr>
    <tr>
      <th>Hungary</th>
      <td>31007.768407</td>
      <td>5.6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;lifesat.csv&quot;</span><span class="p">)</span>
<span class="n">full_country_stats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">datapath</span> <span class="o">/</span> <span class="s2">&quot;lifesat_full.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the data for a few random countries</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_stats</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">x</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lifesat_col</span><span class="p">)</span>

<span class="n">min_life_sat</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">max_life_sat</span> <span class="o">=</span> <span class="mi">9</span>

<span class="n">position_text</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Turkey&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">29_500</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">),</span>
    <span class="s2">&quot;Hungary&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">28_000</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">),</span>
    <span class="s2">&quot;France&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">40_000</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="s2">&quot;New Zealand&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">28_000</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">),</span>
    <span class="s2">&quot;Australia&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">50_000</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">),</span>
    <span class="s2">&quot;United States&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">59_000</span><span class="p">,</span> <span class="mf">5.3</span><span class="p">),</span>
    <span class="s2">&quot;Denmark&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">46_000</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">country</span><span class="p">,</span> <span class="n">pos_text</span> <span class="ow">in</span> <span class="n">position_text</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pos_data_x</span> <span class="o">=</span> <span class="n">country_stats</span><span class="p">[</span><span class="n">gdppc_col</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">country</span><span class="p">]</span>
    <span class="n">pos_data_y</span> <span class="o">=</span> <span class="n">country_stats</span><span class="p">[</span><span class="n">lifesat_col</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">country</span><span class="p">]</span>
    <span class="n">country</span> <span class="o">=</span> <span class="s2">&quot;U.S.&quot;</span> <span class="k">if</span> <span class="n">country</span> <span class="o">==</span> <span class="s2">&quot;United States&quot;</span> <span class="k">else</span> <span class="n">country</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">pos_data_x</span><span class="p">,</span> <span class="n">pos_data_y</span><span class="p">),</span>
                 <span class="n">xytext</span><span class="o">=</span><span class="n">pos_text</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                 <span class="n">shrink</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pos_data_x</span><span class="p">,</span> <span class="n">pos_data_y</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">min_gdp</span><span class="p">,</span> <span class="n">max_gdp</span><span class="p">,</span> <span class="n">min_life_sat</span><span class="p">,</span> <span class="n">max_life_sat</span><span class="p">])</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;money_happy_scatterplot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fe4eb379a149db87446eb0092f28a69b08854f977239b342742609e9898ea28c.png" src="_images/fe4eb379a149db87446eb0092f28a69b08854f977239b342742609e9898ea28c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">highlighted_countries</span> <span class="o">=</span> <span class="n">country_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">position_text</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
<span class="n">highlighted_countries</span><span class="p">[[</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">lifesat_col</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GDP per capita (USD)</th>
      <th>Life satisfaction</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Turkey</th>
      <td>28384.987785</td>
      <td>5.5</td>
    </tr>
    <tr>
      <th>Hungary</th>
      <td>31007.768407</td>
      <td>5.6</td>
    </tr>
    <tr>
      <th>France</th>
      <td>42025.617373</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>New Zealand</th>
      <td>42404.393738</td>
      <td>7.3</td>
    </tr>
    <tr>
      <th>Australia</th>
      <td>48697.837028</td>
      <td>7.3</td>
    </tr>
    <tr>
      <th>Denmark</th>
      <td>55938.212809</td>
      <td>7.6</td>
    </tr>
    <tr>
      <th>United States</th>
      <td>60235.728492</td>
      <td>6.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="model-selection-a-simple-linear-model">
<h3>Model selection: a simple linear model<a class="headerlink" href="#model-selection-a-simple-linear-model" title="Link to this heading">#</a></h3>
<p>life_satisfaction = <span class="math notranslate nohighlight">\(\theta_0 + \theta_1 \times\)</span> GDP_per_capita</p>
<p>This model is just a linear function of the input feature GDP_per_capita. <span class="math notranslate nohighlight">\(\theta_0\)</span> and <span class="math notranslate nohighlight">\(\theta_1\)</span> are
the model’s parameters.</p>
<p>More generally, a linear model makes a prediction by simply computing a weighted sum of the input features, plus a constant called the intercept term (or bias):
$<span class="math notranslate nohighlight">\(
\hat y = \theta_0 + \theta_1 x_1 + \theta_2 x_2 + \dots + \theta_n x_n
\)</span>$</p>
<p>In vectorized form:
$<span class="math notranslate nohighlight">\(
\hat y = \mathbf{\theta} \cdot \mathbf{x}
\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_stats</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">x</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lifesat_col</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_gdp</span><span class="p">,</span> <span class="n">max_gdp</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">w1</span> <span class="o">+</span> <span class="n">w2</span> <span class="o">*</span> <span class="mf">1e-5</span> <span class="o">*</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">40_000</span><span class="p">,</span> <span class="mf">4.9</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;$\theta_0 = </span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">40_000</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;$\theta_1 = </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>

<span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">w1</span> <span class="o">+</span> <span class="n">w2</span> <span class="o">*</span> <span class="mf">1e-5</span> <span class="o">*</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">26_000</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;$\theta_0 = </span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">26_000</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;$\theta_1 = </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2"> \times 10^</span><span class="se">{{</span><span class="s2">-5</span><span class="se">}}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>

<span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">w1</span> <span class="o">+</span> <span class="n">w2</span> <span class="o">*</span> <span class="mf">1e-5</span> <span class="o">*</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">48_000</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;$\theta_0 = </span><span class="si">{</span><span class="n">w1</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">48_000</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="sa">fr</span><span class="s2">&quot;$\theta_1 = </span><span class="si">{</span><span class="n">w2</span><span class="si">}</span><span class="s2"> \times 10^</span><span class="se">{{</span><span class="s2">-5</span><span class="se">}}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">min_gdp</span><span class="p">,</span> <span class="n">max_gdp</span><span class="p">,</span> <span class="n">min_life_sat</span><span class="p">,</span> <span class="n">max_life_sat</span><span class="p">])</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;tweaking_model_params_plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7820ecec1d24d6861caf1e7b70f443c4c0c604ad9cd41d0fc9dbf386019123f4.png" src="_images/7820ecec1d24d6861caf1e7b70f443c4c0c604ad9cd41d0fc9dbf386019123f4.png" />
</div>
</div>
<p>Now, how do we train the model?</p>
<blockquote>
<div><p>Training a model means setting its parameters so that the model best fits the training set.</p>
</div></blockquote>
<p>For this purpose, we first need a measure of how well (or poorly) the model fits the training data.
The most common performance measure of a regression model is the Mean Square Error (MSE).
So, to train a Linear Regression model, you need to find the value of θ that minimizes the MSE.</p>
<p>The MSE of a Linear Regression hypothesis <span class="math notranslate nohighlight">\(h_θ\)</span> on a training set <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> is calculated using:
$<span class="math notranslate nohighlight">\(
\mathrm{MSE}(X, h_θ) = \frac{1}{m} \sum_{i = 1}^{m} \big( \mathbf{\theta}^T \mathbf{x}^{(i)} − y^{(i)} \big)^2
\)</span>$</p>
</section>
<section id="the-normal-equation">
<h3>The Normal Equation<a class="headerlink" href="#the-normal-equation" title="Link to this heading">#</a></h3>
<p>To find the value of <span class="math notranslate nohighlight">\(\theta\)</span> that minimizes the cost function, there is a closed-form solution —in other words, a mathematical equation that gives the result directly.</p>
<p>This is called the <em>Normal Equation</em>:
$<span class="math notranslate nohighlight">\(
\mathbf{\hat \theta} = (\mathbf{X}^T\mathbf{X})^{−1} \mathbf{X}^T \mathbf{y}
\)</span>$</p>
<p>The normal equation can be computed using <code class="docutils literal notranslate"><span class="pre">NumPy</span></code>’s Linear Algebra module (<code class="docutils literal notranslate"><span class="pre">np.linalg</span></code>)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">theta_best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X_b</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X_b</span><span class="p">)</span> <span class="o">@</span> <span class="n">X_b</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">y</span>
</pre></div>
</div>
<blockquote>
<div><p>However, The computational complexity of inverting such a matrix is typically about <span class="math notranslate nohighlight">\(O(n^{2.4})\)</span> to <span class="math notranslate nohighlight">\(O(n^3)\)</span> (depending on the implementation).</p>
</div></blockquote>
<p>In other words, if you double the number of features, you multiply the computation time by roughly <span class="math notranslate nohighlight">\(2^{2.4} = 5.3\)</span> to <span class="math notranslate nohighlight">\(2^3 = 8\)</span>.</p>
<p>Instead, the approach used by <code class="docutils literal notranslate"><span class="pre">Scikit-Learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> class is about <span class="math notranslate nohighlight">\(O(n^2)\)</span>.</p>
<p>If you double the number of features, you multiply the computation time by roughly 4.</p>
</section>
<section id="least-squares-minimization">
<h3>Least Squares Minimization<a class="headerlink" href="#least-squares-minimization" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> class is based on the <code class="docutils literal notranslate"><span class="pre">scipy.linalg.lstsq()</span></code> function.</p>
<p>This function computes <span class="math notranslate nohighlight">\(\mathbf{\hat\theta} = \mathbf{X}^\dagger\mathbf{y}\)</span>, where <span class="math notranslate nohighlight">\(\mathbf{X}^\dagger\)</span> is the pseudoinverse of <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>.</p>
<p>The pseudoinverse itself is computed using a standard matrix factorization technique called <strong>Singular Value Decomposition</strong> (SVD)</p>
<p>This approach is more efficient than computing the <em>Normal Equation</em>, plus it handles edge cases nicely.</p>
<p>Indeed, the Normal Equation may not work if the matrix <span class="math notranslate nohighlight">\(\mathbf{X}^T\mathbf{X}\)</span> is not invertible, but the pseudoinverse is always defined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>

<span class="n">X_sample</span> <span class="o">=</span> <span class="n">country_stats</span><span class="p">[[</span><span class="n">gdppc_col</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_sample</span> <span class="o">=</span> <span class="n">country_stats</span><span class="p">[[</span><span class="n">lifesat_col</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>

<span class="n">lin1</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lin1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sample</span><span class="p">,</span> <span class="n">y_sample</span><span class="p">)</span>

<span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">lin1</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lin1</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;θ0=</span><span class="si">{</span><span class="n">t0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, θ1=</span><span class="si">{</span><span class="n">t1</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>θ0=3.75, θ1=6.78e-05
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_stats</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">x</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lifesat_col</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_gdp</span><span class="p">,</span> <span class="n">max_gdp</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">max_gdp</span> <span class="o">-</span> <span class="mi">20_000</span><span class="p">,</span> <span class="n">min_life_sat</span> <span class="o">+</span> <span class="mf">1.9</span><span class="p">,</span>
         <span class="sa">fr</span><span class="s2">&quot;$\theta_0 = </span><span class="si">{</span><span class="n">t0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">max_gdp</span> <span class="o">-</span> <span class="mi">20_000</span><span class="p">,</span> <span class="n">min_life_sat</span> <span class="o">+</span> <span class="mf">1.3</span><span class="p">,</span>
         <span class="sa">fr</span><span class="s2">&quot;$\theta_1 = </span><span class="si">{</span><span class="n">t1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e5</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> \times 10^</span><span class="se">{{</span><span class="s2">-5</span><span class="se">}}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">min_gdp</span><span class="p">,</span> <span class="n">max_gdp</span><span class="p">,</span> <span class="n">min_life_sat</span><span class="p">,</span> <span class="n">max_life_sat</span><span class="p">])</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;best_fit_model_plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/23d405bdc7c91e7ba46a1be29982fb04598c9d0efd7030a57337baa5733b4932.png" src="_images/23d405bdc7c91e7ba46a1be29982fb04598c9d0efd7030a57337baa5733b4932.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cyprus_gdp_per_capita</span> <span class="o">=</span> <span class="n">gdp_per_capita</span><span class="p">[</span><span class="n">gdppc_col</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Cyprus&quot;</span><span class="p">]</span>
<span class="n">cyprus_gdp_per_capita</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>37655.1803457421
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cyprus_predicted_life_satisfaction</span> <span class="o">=</span> <span class="n">lin1</span><span class="o">.</span><span class="n">predict</span><span class="p">([[</span><span class="n">cyprus_gdp_per_capita</span><span class="p">]])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">cyprus_predicted_life_satisfaction</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.301656332738056
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_stats</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">x</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lifesat_col</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_gdp</span><span class="p">,</span> <span class="n">max_gdp</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">min_gdp</span> <span class="o">+</span> <span class="mi">22_000</span><span class="p">,</span> <span class="n">max_life_sat</span> <span class="o">-</span> <span class="mf">1.1</span><span class="p">,</span>
         <span class="sa">fr</span><span class="s2">&quot;$\theta_0 = </span><span class="si">{</span><span class="n">t0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">min_gdp</span> <span class="o">+</span> <span class="mi">22_000</span><span class="p">,</span> <span class="n">max_life_sat</span> <span class="o">-</span> <span class="mf">0.6</span><span class="p">,</span>
         <span class="sa">fr</span><span class="s2">&quot;$\theta_1 = </span><span class="si">{</span><span class="n">t1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e5</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> \times 10^</span><span class="se">{{</span><span class="s2">-5</span><span class="se">}}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">cyprus_gdp_per_capita</span><span class="p">,</span> <span class="n">cyprus_gdp_per_capita</span><span class="p">],</span>
         <span class="p">[</span><span class="n">min_life_sat</span><span class="p">,</span> <span class="n">cyprus_predicted_life_satisfaction</span><span class="p">],</span> <span class="s2">&quot;r--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">cyprus_gdp_per_capita</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span>
         <span class="sa">fr</span><span class="s2">&quot;Prediction = </span><span class="si">{</span><span class="n">cyprus_predicted_life_satisfaction</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cyprus_gdp_per_capita</span><span class="p">,</span> <span class="n">cyprus_predicted_life_satisfaction</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">min_gdp</span><span class="p">,</span> <span class="n">max_gdp</span><span class="p">,</span> <span class="n">min_life_sat</span><span class="p">,</span> <span class="n">max_life_sat</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/701ef314d7e2a3fa696ab3c0ca947a1f69f7f361f4bc84683e01c7b1e3523896.png" src="_images/701ef314d7e2a3fa696ab3c0ca947a1f69f7f361f4bc84683e01c7b1e3523896.png" />
</div>
</div>
</section>
</section>
<section id="main-challenges-in-machine-learning">
<h2>Main Challenges in Machine Learning<a class="headerlink" href="#main-challenges-in-machine-learning" title="Link to this heading">#</a></h2>
<section id="quantity-of-training-data">
<h3>Quantity of Training Data<a class="headerlink" href="#quantity-of-training-data" title="Link to this heading">#</a></h3>
<p>It takes a lot of data for most Machine Learning algorithms to work properly.</p>
<p>Even for very simple problems you typically need thousands of examples, and for complex problems such as image or speech recognition you may need millions…</p>
<p>Also, in order to generalize well, it is crucial that your training data be representative of the
new cases you want to generalize to.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missing_data</span> <span class="o">=</span> <span class="n">full_country_stats</span><span class="p">[(</span><span class="n">full_country_stats</span><span class="p">[</span><span class="n">gdppc_col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_gdp</span><span class="p">)</span> <span class="o">|</span>
                                  <span class="p">(</span><span class="n">full_country_stats</span><span class="p">[</span><span class="n">gdppc_col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_gdp</span><span class="p">)]</span>
<span class="n">missing_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GDP per capita (USD)</th>
      <th>Life satisfaction</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>South Africa</th>
      <td>11466.189672</td>
      <td>4.7</td>
    </tr>
    <tr>
      <th>Colombia</th>
      <td>13441.492952</td>
      <td>6.3</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>14063.982505</td>
      <td>6.4</td>
    </tr>
    <tr>
      <th>Mexico</th>
      <td>17887.750736</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>23324.524751</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>Norway</th>
      <td>63585.903514</td>
      <td>7.6</td>
    </tr>
    <tr>
      <th>Switzerland</th>
      <td>68393.306004</td>
      <td>7.5</td>
    </tr>
    <tr>
      <th>Ireland</th>
      <td>89688.956958</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>Luxembourg</th>
      <td>110261.157353</td>
      <td>6.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">position_text_missing_countries</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;South Africa&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">20_000</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">),</span>
    <span class="s2">&quot;Colombia&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">6_000</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">),</span>
    <span class="s2">&quot;Brazil&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">18_000</span><span class="p">,</span> <span class="mf">7.8</span><span class="p">),</span>
    <span class="s2">&quot;Mexico&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">24_000</span><span class="p">,</span> <span class="mf">7.4</span><span class="p">),</span>
    <span class="s2">&quot;Chile&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">30_000</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">),</span>
    <span class="s2">&quot;Norway&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">51_000</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">),</span>
    <span class="s2">&quot;Switzerland&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">62_000</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">),</span>
    <span class="s2">&quot;Ireland&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">81_000</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">),</span>
    <span class="s2">&quot;Luxembourg&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">92_000</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>For example, the set of countries we used earlier for training the linear model was not
perfectly representative; a few countries were missing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_country_stats</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lifesat_col</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">country</span><span class="p">,</span> <span class="n">pos_text</span> <span class="ow">in</span> <span class="n">position_text_missing_countries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pos_data_x</span><span class="p">,</span> <span class="n">pos_data_y</span> <span class="o">=</span> <span class="n">missing_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">country</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">pos_data_x</span><span class="p">,</span> <span class="n">pos_data_y</span><span class="p">),</span>
                 <span class="n">xytext</span><span class="o">=</span><span class="n">pos_text</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                 <span class="n">shrink</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pos_data_x</span><span class="p">,</span> <span class="n">pos_data_y</span><span class="p">,</span> <span class="s2">&quot;rs&quot;</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">115_000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;b:&quot;</span><span class="p">)</span>

<span class="n">lin_reg_full</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">Xfull</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">full_country_stats</span><span class="p">[</span><span class="n">gdppc_col</span><span class="p">]]</span>
<span class="n">yfull</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">full_country_stats</span><span class="p">[</span><span class="n">lifesat_col</span><span class="p">]]</span>
<span class="n">lin_reg_full</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xfull</span><span class="p">,</span> <span class="n">yfull</span><span class="p">)</span>

<span class="n">t0full</span><span class="p">,</span> <span class="n">t1full</span> <span class="o">=</span> <span class="n">lin_reg_full</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lin_reg_full</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">115_000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">t0full</span> <span class="o">+</span> <span class="n">t1full</span> <span class="o">*</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">115_000</span><span class="p">,</span> <span class="n">min_life_sat</span><span class="p">,</span> <span class="n">max_life_sat</span><span class="p">])</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;representative_training_data_scatterplot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/07e795a265a7544815324ba74c05bf3479d15c6781e2adaf863d9010750ad602.png" src="_images/07e795a265a7544815324ba74c05bf3479d15c6781e2adaf863d9010750ad602.png" />
</div>
</div>
<p>Not only does adding a few missing countries significantly alter the model, but it makes it clear that such a simple linear model is probably never going to work well. It seems that very rich countries are not happier than moderately rich countries (in fact they seem unhappier), and conversely some poor countries seem happier than many rich countries</p>
</section>
<section id="poor-quality-data">
<h3>Poor-quality data<a class="headerlink" href="#poor-quality-data" title="Link to this heading">#</a></h3>
<p>Obviously, if your training data is full of errors, outliers, and noise (e.g., due to poorquality
measurements), it will make it harder for the system to detect the underlying
patterns, so your system is less likely to perform well. It is often well worth the effort
to spend time cleaning up your training data. The truth is, most data scientists spend
a significant part of their time doing just that. For example:</p>
<ul class="simple">
<li><p>If some instances are clearly outliers, it may help to simply discard them or try to
fix the errors manually.</p></li>
<li><p>If some instances are missing a few features (e.g., 5% of your customers did not
specify their age), you must decide whether you want to ignore this attribute altogether,
ignore these instances, fill in the missing values (e.g., with the median
age), or train one model with the feature and one model without it, and so on.</p></li>
</ul>
</section>
<section id="irrelevant-features">
<h3>Irrelevant Features<a class="headerlink" href="#irrelevant-features" title="Link to this heading">#</a></h3>
<p>Garbage In, Garbage Out.</p>
<p>Your system will only be capable of learning if the training data contains enough relevant features and not too many irrelevant ones. A critical part of the success of a Machine Learning project is coming up with a good set of features to train on. This process, called <strong>feature engineering</strong>, involves:</p>
<ul class="simple">
<li><p><strong>Feature selection</strong>: selecting the most useful features to train on among existing
features.</p></li>
<li><p><strong>Feature extraction</strong>: combining existing features to produce a more useful one (as
we saw earlier, dimensionality reduction algorithms can help).</p></li>
<li><p>Creating new features by gathering new data.</p></li>
</ul>
</section>
<section id="overfitting-the-training-data">
<h3>Overfitting the Training Data<a class="headerlink" href="#overfitting-the-training-data" title="Link to this heading">#</a></h3>
<p>Overfitting happens when the model is too complex relative to the amount and noisiness of the training data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">pipeline</span>

<span class="n">full_country_stats</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lifesat_col</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">poly</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">lin_reg2</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>

<span class="n">pipeline_reg</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;poly&#39;</span><span class="p">,</span> <span class="n">poly</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;scal&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lin&#39;</span><span class="p">,</span> <span class="n">lin_reg2</span><span class="p">)])</span>
<span class="n">pipeline_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xfull</span><span class="p">,</span> <span class="n">yfull</span><span class="p">)</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">pipeline_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">curve</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">115_000</span><span class="p">,</span> <span class="n">min_life_sat</span><span class="p">,</span> <span class="n">max_life_sat</span><span class="p">])</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;overfitting_model_plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6bc28607b25f132dd8dec974a816ce256e543b1d6ce67a9a9a900371a080e05e.png" src="_images/6bc28607b25f132dd8dec974a816ce256e543b1d6ce67a9a9a900371a080e05e.png" />
</div>
</div>
<p>The possible solutions are:</p>
<ul class="simple">
<li><p>To simplify the model by selecting one with fewer parameters (e.g., a linear model rather than a high-degree polynomial
model), by reducing the number of attributes in the training data or by constraining the model</p></li>
<li><p>To gather more training data</p></li>
<li><p>To reduce the noise in the training data (e.g., fix data errors and remove outliers)</p></li>
</ul>
<section id="model-regularization">
<h4>Model Regularization<a class="headerlink" href="#model-regularization" title="Link to this heading">#</a></h4>
<p>Constraining a model to make it simpler and reduce the risk of overfitting is called <strong>regularization</strong>.</p>
<p>For example, the linear model we defined earlier has two parameters. This gives the learning algorithm two degrees of freedom to adapt the model to the training data: it can tweak both the height (<span class="math notranslate nohighlight">\(\theta_0\)</span>) and the slope (<span class="math notranslate nohighlight">\(\theta_1\)</span>) of the line.</p>
<p>If we forced <span class="math notranslate nohighlight">\(\theta_1 = 0\)</span>, the algorithm would have only one degree of freedom and would have a much harder time fitting the data properly: all it could do is move the line up or down to get as close as possible to the training instances, so it would end up around the mean.</p>
<p>If we allow the algorithm to modify <span class="math notranslate nohighlight">\(\theta_1\)</span> but we force it to keep it small, then the learning algorithm will effectively have somewhere in between one and two degrees of freedom. It will produce a simpler model than with two degrees of freedom, but more complex than with just one. You want to find the right balance between fitting the training data perfectly and keeping the model simple enough to ensure that it will generalize well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_countries</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">full_country_stats</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
<span class="n">full_country_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w_countries</span><span class="p">][</span><span class="n">lifesat_col</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Country
New Zealand    7.3
Sweden         7.3
Norway         7.6
Switzerland    7.5
Name: Life satisfaction, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_w_countries</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">gdp_per_capita</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
<span class="n">gdp_per_capita</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">all_w_countries</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GDP per capita (USD)</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Malawi</th>
      <td>1486.778248</td>
    </tr>
    <tr>
      <th>Rwanda</th>
      <td>2098.710362</td>
    </tr>
    <tr>
      <th>Zimbabwe</th>
      <td>2744.690758</td>
    </tr>
    <tr>
      <th>Africa Western and Central</th>
      <td>4003.158913</td>
    </tr>
    <tr>
      <th>Papua New Guinea</th>
      <td>4101.218882</td>
    </tr>
    <tr>
      <th>Lower middle income</th>
      <td>6722.809932</td>
    </tr>
    <tr>
      <th>Eswatini</th>
      <td>8392.717564</td>
    </tr>
    <tr>
      <th>Low &amp; middle income</th>
      <td>10293.855325</td>
    </tr>
    <tr>
      <th>Arab World</th>
      <td>13753.707307</td>
    </tr>
    <tr>
      <th>Botswana</th>
      <td>16040.008473</td>
    </tr>
    <tr>
      <th>World</th>
      <td>16194.040310</td>
    </tr>
    <tr>
      <th>New Zealand</th>
      <td>42404.393738</td>
    </tr>
    <tr>
      <th>Sweden</th>
      <td>50683.323510</td>
    </tr>
    <tr>
      <th>Norway</th>
      <td>63585.903514</td>
    </tr>
    <tr>
      <th>Switzerland</th>
      <td>68393.306004</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_stats</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lifesat_col</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">missing_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">gdppc_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lifesat_col</span><span class="p">,</span>
                  <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">115_000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">t1</span><span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="s2">&quot;b:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Linear model on partial data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">t0full</span> <span class="o">+</span> <span class="n">t1full</span> <span class="o">*</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Linear model on all data&quot;</span><span class="p">)</span>

<span class="n">ridge</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="mf">9.5</span><span class="p">)</span>
<span class="n">X_sample</span> <span class="o">=</span> <span class="n">country_stats</span><span class="p">[[</span><span class="n">gdppc_col</span><span class="p">]]</span>
<span class="n">y_sample</span> <span class="o">=</span> <span class="n">country_stats</span><span class="p">[[</span><span class="n">lifesat_col</span><span class="p">]]</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sample</span><span class="p">,</span> <span class="n">y_sample</span><span class="p">)</span>
<span class="n">t0ridge</span><span class="p">,</span> <span class="n">t1ridge</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">intercept_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ridge</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">t0ridge</span> <span class="o">+</span> <span class="n">t1ridge</span> <span class="o">*</span> <span class="n">X</span><span class="p">,</span> <span class="s2">&quot;b--&quot;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Regularized linear model on partial data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">115_000</span><span class="p">,</span> <span class="n">min_life_sat</span><span class="p">,</span> <span class="n">max_life_sat</span><span class="p">])</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;ridge_model_plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7912508ec48e4bf6503bc576e097240b7a379fb6a0b05dd37a36b719a6e74346.png" src="_images/7912508ec48e4bf6503bc576e097240b7a379fb6a0b05dd37a36b719a6e74346.png" />
</div>
</div>
</section>
</section>
<section id="underfitting-the-training-data">
<h3>Underfitting the Training Data<a class="headerlink" href="#underfitting-the-training-data" title="Link to this heading">#</a></h3>
<p>Underfitting is the opposite of overfitting: it occurs when your model is too simple to learn the underlying structure of the data. For example, a linear model of life satisfaction is prone to underfit; reality is just more complex than
the model, so its predictions are bound to be inaccurate, even on the training examples.</p>
<p>The main options to fix this problem are:</p>
<ul class="simple">
<li><p>Selecting a more powerful model, with more parameters</p></li>
<li><p>Feeding better features to the learning algorithm (feature engineering)</p></li>
<li><p>Reducing the constraints on the model (e.g., reducing the regularization hyperparameter)</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">The Machine Learning Fundamentals</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-machine-learning-pipeline">The Machine Learning Pipeline</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-classification-and-clustering">Regression, Classification, and Clustering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-main-steps-of-the-machine-learning-pipeline">The main steps of the machine learning pipeline</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-example-does-money-make-people-happier">Code example: Does money make people happier?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-and-prepare-life-satisfaction-data">Load and prepare Life satisfaction data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection-a-simple-linear-model">Model selection: a simple linear model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-normal-equation">The Normal Equation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-minimization">Least Squares Minimization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-challenges-in-machine-learning">Main Challenges in Machine Learning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quantity-of-training-data">Quantity of Training Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#poor-quality-data">Poor-quality data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#irrelevant-features">Irrelevant Features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overfitting-the-training-data">Overfitting the Training Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#model-regularization">Model Regularization</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#underfitting-the-training-data">Underfitting the Training Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Biagio Mandracchia
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>